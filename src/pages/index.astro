---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import getSortedPosts from "@utils/getSortedPosts";
import { SITE } from "@config";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);

// Format date helper
function formatDate(date: Date): string {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}
---

<Layout>
  <Header />
  <main id="main-content">
    <!-- Blog Hero Section -->
    <section class="blog-hero">
      <div class="blog-hero-content">
        <h1 class="blog-hero-title">{SITE.title}</h1>
        <p class="blog-hero-subtitle">{SITE.desc}</p>
      </div>
    </section>

    <!-- Blog Posts Grid -->
    <section class="blog-posts">
      <div class="blog-posts-container">
        {
          sortedPosts.length > 0 ? (
            <div class="blog-posts-grid">
              {sortedPosts.map(({ data, slug }) => (
                <article class="blog-card">
                  <a href={`/posts/${slug}/`} class="blog-card-link">
                    <div class="blog-card-image blog-card-image--placeholder">
                      <svg
                        class="blog-card-placeholder-icon"
                        xmlns="http://www.w3.org/2000/svg"
                        width="64"
                        height="64"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                      >
                        <path d="M19 3H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2zM5 19V5h14l.002 14H5z" />
                        <path d="m10 14-1-1-3 4h12l-5-7z" />
                      </svg>
                    </div>
                    <div class="blog-card-content">
                      <div class="blog-card-meta">
                        {data.tags && data.tags[0] && (
                          <span class="blog-card-category">{data.tags[0]}</span>
                        )}
                        <span>{formatDate(data.pubDatetime)}</span>
                      </div>
                      <h2 class="blog-card-title">{data.title}</h2>
                      <p class="blog-card-excerpt">{data.description}</p>
                    </div>
                  </a>
                </article>
              ))}
            </div>
          ) : (
            <div class="blog-no-posts">
              <h2>No posts yet</h2>
              <p>Check back soon for new content!</p>
            </div>
          )
        }
      </div>
    </section>
  </main>

  <Footer />
</Layout>
